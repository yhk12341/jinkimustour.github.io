<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‰´ìš• ì—¬í–‰ ğŸ‡ºğŸ‡¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <style>
        body { font-family: 'Noto Sans KR', 'Inter', sans-serif; scroll-behavior: smooth; }
        .section-title { font-family: 'Noto Sans KR', sans-serif; font-weight: 900; }
        .header-title { text-shadow: 0 0 8px rgba(255, 255, 255, 0.4), 3px 3px 8px rgba(0, 0, 0, 0.8); }
        .tab-button.active { color: #2563eb; border-bottom-color: #2563eb; font-weight: 700; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out; }
        [contenteditable]:focus { outline: 2px solid #3b82f6; background-color: #eff6ff; border-radius: 4px; }
        .timeline-item { position: relative; padding-left: 3rem; padding-bottom: 2.5rem; }
        .timeline-item:last-child { padding-bottom: 0; }
        .timeline-item::before { content: ''; position: absolute; left: calc(1rem - 1px); top: 1.5rem; bottom: -1.5rem; width: 2px; background-color: #e5e7eb; }
        .timeline-item:last-child::before { display: none; }
        .timeline-icon { position: absolute; left: 0; top: 0.5rem; width: 2rem; height: 2rem; display: flex; align-items: center; justify-content: center; border-radius: 50%; background-color: white; border: 2px solid #e5e7eb; }
        .delete-btn { opacity: 0; transition: opacity 0.2s; }
        .checklist-section:hover .delete-section-btn, .checklist-item:hover .delete-btn, .settlement-item:hover .delete-btn { opacity: 1; }
        .status-toggle { cursor: pointer; padding: 4px 10px; border-radius: 9999px; font-size: 0.8rem; font-weight: 500; transition: all 0.2s; }
        .status-toggle.pending { background-color: #fee2e2; color: #b91c1c; }
        .status-toggle.paid { background-color: #dcfce7; color: #166534; }
        .user1-payment-row { background-color: #eff6ff; }
        .user2-payment-row { background-color: #f0fdf4; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="relative bg-white shadow-md">
        <div class="absolute inset-0"><img src="https://upload.wikimedia.org/wikipedia/commons/4/47/New_york_times_square-terabass.jpg" class="w-full h-full object-cover" alt="New York Times Square"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-black/20"></div>
        <div class="relative max-w-7xl mx-auto pt-20 pb-10 px-4 text-center text-white"><h1 class="text-4xl md:text-6xl font-extrabold tracking-tight section-title header-title">ë‰´ìš• ì—¬í–‰ ğŸ‡ºğŸ‡¸</h1><p class="mt-4 text-xl md:text-2xl font-semibold header-title">2025. 10. 23 (ëª©) - 2025. 11. 06 (ëª©)</p></div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div id="countdown" class="my-6"><div class="relative rounded-lg p-4 flex items-center justify-center text-white bg-gray-800/70 backdrop-blur-sm shadow-xl"><div id="countdown-container" class="text-center"><div class="text-5xl sm:text-6xl font-bold" id="days">0</div><p class="mt-1 text-sm font-semibold">DAYS LEFT</p></div></div></div>
        
        <div class="bg-white rounded-t-lg shadow-lg border-b border-gray-200 sticky top-0 z-20">
            <nav class="flex justify-around flex-wrap" id="main-tabs">
                <button data-tab="overview" class="tab-button active w-1/3 md:w-auto flex-grow py-4 px-2 text-center border-b-2 border-transparent text-xs sm:text-base transition">ê°œìš”</button>
                <button data-tab="itinerary" class="tab-button w-1/3 md:w-auto flex-grow py-4 px-2 text-center border-b-2 border-transparent text-xs sm:text-base transition">ìƒì„¸ ì¼ì •</button>
                <button data-tab="accommodation" class="tab-button w-1/3 md:w-auto flex-grow py-4 px-2 text-center border-b-2 border-transparent text-xs sm:text-base transition">ìˆ™ì†Œ</button>
                <button data-tab="settlement" class="tab-button w-1/3 md:w-auto flex-grow py-4 px-2 text-center border-b-2 border-transparent text-xs sm:text-base transition">ì •ì‚°/ì¤€ë¹„</button>
                <button data-tab="info" class="tab-button w-1/3 md:w-auto flex-grow py-4 px-2 text-center border-b-2 border-transparent text-xs sm:text-base transition">ë§›ì§‘/ì •ë³´</button>
            </nav>
        </div>

        <main class="bg-white rounded-b-lg shadow-lg p-4 sm:p-8">
            <div id="overview" class="tab-content"><h2 class="section-title text-3xl font-bold mb-8">ğŸ—ºï¸ ì—¬í–‰ ê°œìš”</h2><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="bg-gray-50 p-6 rounded-lg"><h3 class="font-bold text-xl mb-6">ì´ë™ ê²½ë¡œ</h3><div class="timeline"><div class="timeline-item"><div class="timeline-icon"><ion-icon name="business-outline" class="text-xl text-blue-500"></ion-icon></div><div><p class="text-sm text-gray-500">10/23 - 10/26</p><strong class="text-lg">ë‰´ìš• (ë¯¸ë“œíƒ€ìš´)</strong></div></div><div class="timeline-item"><div class="timeline-icon"><ion-icon name="water-outline" class="text-xl text-cyan-500"></ion-icon></div><div><p class="text-sm text-gray-500">10/26 - 10/27</p><strong class="text-lg">ë‚˜ì´ì•„ê°€ë¼</strong></div></div><div class="timeline-item"><div class="timeline-icon"><ion-icon name="business-outline" class="text-xl text-blue-500"></ion-icon></div><div><p class="text-sm text-gray-500">10/27 - 11/02</p><strong class="text-lg">ë‰´ìš• (ë‹¤ìš´íƒ€ìš´)</strong></div></div><div class="timeline-item"><div class="timeline-icon"><ion-icon name="flag-outline" class="text-xl text-red-500"></ion-icon></div><div><p class="text-sm text-gray-500">11/02 - 11/03</p><strong class="text-lg">ì›Œì‹±í„´ D.C.</strong></div></div><div class="timeline-item"><div class="timeline-icon"><ion-icon name="business-outline" class="text-xl text-blue-500"></ion-icon></div><div><p class="text-sm text-gray-500">11/03 - 11/06</p><strong class="text-lg">ë‰´ìš• (í€¸ì¦ˆ)</strong></div></div></div></div><div class="bg-gray-50 p-6 rounded-lg flex flex-col"><h3 class="font-bold text-xl mb-4">ë‚´ ì—¬í–‰ ì§€ë„</h3><div class="flex-grow w-full h-full min-h-[300px] rounded-md overflow-hidden"><iframe src="https://www.google.com/maps/d/embed?mid=1U-2rTW6OfqgexwLOz_B7zhMLDacTHQw" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe></div></div></div></div>
            <div id="itinerary" class="tab-content hidden"><h2 class="section-title text-3xl font-bold mb-6">ğŸ—“ï¸ ìƒì„¸ ì¼ì •</h2><div class="space-y-4" id="itinerary-accordion"></div></div>
            <div id="accommodation" class="tab-content hidden"><h2 class="section-title text-3xl font-bold mb-6">ğŸ¨ ìˆ™ì†Œ ì •ë³´</h2><div class="space-y-4" id="accommodation-list"></div></div>
            <div id="settlement" class="tab-content hidden"><h2 class="section-title text-3xl font-bold mb-6">ğŸ“Š ì •ì‚° ë° ì¤€ë¹„ë¬¼ ê´€ë¦¬</h2><div class="mb-12"><h3 class="font-bold text-xl mb-4 flex items-center gap-2"><ion-icon name="calculator-outline"></ion-icon>ê³µë™ ê²½ë¹„ ì •ì‚°</h3><div class="bg-gray-50 p-4 rounded-lg"><form id="settlement-form" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-3 items-end mb-4"><input type="date" id="settlement-date" class="p-2 border rounded-md text-sm" required><input type="text" id="settlement-desc" placeholder="ë‚´ìš©" class="p-2 border rounded-md text-sm sm:col-span-2" required><input type="number" id="settlement-amount" placeholder="ê¸ˆì•¡ ($)" class="p-2 border rounded-md text-sm" step="0.01" required><div class="grid grid-cols-2 gap-2"><select id="settlement-payer" class="p-2 border rounded-md text-sm"></select><button type="submit" class="bg-blue-500 text-white font-semibold p-2 rounded-md hover:bg-blue-600 transition">ì¶”ê°€</button></div></form><div class="overflow-x-auto mb-4"><table class="w-full text-left text-sm whitespace-nowrap"><thead class="border-b"><th class="p-2">ë‚ ì§œ</th><th class="p-2">ë‚´ìš©</th><th class="p-2 text-right">ê¸ˆì•¡</th><th class="p-2 text-center">ê²°ì œì</th><th class="p-2 text-right"></th></thead><tbody id="settlement-list"></tbody></table></div><div id="settlement-summary" class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-center"></div></div></div><div class="mb-12"><h3 class="font-bold text-xl mb-4 flex items-center gap-2"><ion-icon name="cash-outline"></ion-icon>ì˜ˆì‚° ê³„íš (1ì¸ ê¸°ì¤€)</h3><div class="overflow-x-auto bg-gray-50 p-4 rounded-lg"><table class="w-full text-left" id="budget-table"><thead><tr class="border-b"><th class="p-3">í•­ëª©</th><th class="p-3 text-right">ì˜ˆìƒ ë¹„ìš© (â‚©)</th><th class="p-3 text-center">ìƒíƒœ</th></tr></thead><tbody></tbody><tfoot class="bg-gray-200"><tr><td class="p-3 font-extrabold text-lg">í•©ê³„</td><td id="total-cost" class="p-3 text-right font-extrabold text-lg" colspan="2">â‚©0 + Î±</td></tr></tfoot></table></div></div><div><div class="flex justify-between items-center mb-4"><h3 class="font-bold text-xl flex items-center gap-2"><ion-icon name="checkmark-done-outline"></ion-icon>ì²´í¬ë¦¬ìŠ¤íŠ¸</h3><button id="add-checklist-section-btn" class="text-sm bg-blue-500 text-white font-semibold py-1 px-3 rounded-md hover:bg-blue-600 transition">+ ì„¹ì…˜ ì¶”ê°€</button></div><div id="checklist-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div></div></div>
            <div id="info" class="tab-content hidden"><h2 class="section-title text-3xl font-bold mb-6">ğŸ½ï¸ ë§›ì§‘ ë° ì •ë³´</h2><div class="mb-12"><h3 class="font-bold text-xl mb-4 flex items-center gap-2"><ion-icon name="restaurant-outline"></ion-icon>ë‰´ìš• ì¶”ì²œ ë§›ì§‘</h3><div id="restaurant-accordion-container" class="space-y-2"></div></div><div><h3 class="font-bold text-xl mb-4 flex items-center gap-2"><ion-icon name="information-circle-outline"></ion-icon>ìœ ìš©í•œ ì—¬í–‰ ì •ë³´</h3><div class="space-y-4" id="tips-list"></div></div></div>
        </main>
    </div>

    <footer class="bg-gray-200 mt-12 py-6"><div class="max-w-7xl mx-auto px-4 text-center text-gray-600"><p>Â© 2025 US Trip Planner. All rights reserved.</p></div></footer>
    
    <script>
    const STORAGE_KEY = 'us_trip_data_v16';
    const USD_TO_KRW = 1380;
    const DEFAULT_DATA = {
        user1Name: "ê¹€ìš©í•˜",
        user2Name: "ì§„ìœ ì˜",
        budget: [
            { item: "í•­ê³µê¶Œ", cost: 1370000, status: 'paid' }, { item: "ìˆ™ë°•ë¹„ (Në¹µê¸°ì¤€)", cost: 1465704, status: 'pending' },
            { item: "êµí†µë¹„", cost: 500000, status: 'pending' }, { item: "ì‹ë¹„", cost: 2000000, status: 'pending' },
            { item: "ê´€ê´‘/ì•¡í‹°ë¹„í‹°", cost: 600000, status: 'pending' }, { item: "ì‡¼í•‘", cost: 0, status: 'special' }
        ],
        accommodations: [
            { dates: '10/23-26', name: 'íœìŠ¤í…Œì´ì…˜ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤', price: 591408, booked: true, address: "408 8th Ave, New York, NY 10001", memo: "" },
            { dates: '10/26-27', name: 'ë©”ë¦¬ì–´íŠ¸ ë‚˜ì´ì•„ê°€ë¼í´ìŠ¤ë·°', price: 350000, booked: true, address: "6700 Fallsview Blvd, Niagara Falls, ON L2G 3W6", memo: "" },
            { dates: '10/27-11/2', name: 'North Bergen ì—ì–´ë¹„ì•¤ë¹„', price: 1030000, booked: true, address: "6814 Smith Ave, North Bergen, NJ 07047", memo: "" },
            { dates: '11/2-3', name: 'Yotel ì›Œì‹±í„´ D.C.', price: 240000, booked: true, address: "415 New Jersey Ave NW, Washington, DC 20001", memo: "" },
            { dates: '11/3-6', name: 'ë‰´ìš• í€¸ì¦ˆ ì—ì–´ë¹„ì•¤ë¹„', price: 720000, booked: false, address: "Queens, NY", memo: "" },
        ],
        restaurants: {
            "ë‰´ìš• í´ë˜ì‹": [
                { name: "Peter Luger", food: "ìŠ¤í…Œì´í¬", address: "178 Broadway, Brooklyn, NY 11211"},
                { name: "Katz's Deli", food: "íŒŒìŠ¤íŠ¸ë¼ë¯¸", address: "205 E Houston St, New York, NY 10002"},
                { name: "Balthazar", food: "í”„ë Œì¹˜ ë¹„ìŠ¤íŠ¸ë¡œ", address: "80 Spring St, New York, NY 10012"},
                { name: "Keens Steakhouse", food: "ìŠ¤í…Œì´í¬", address: "72 W 36th St, New York, NY 10018"}
            ],
            "í”¼ì & ìƒŒë“œìœ„ì¹˜": [
                { name: "Joe's Pizza", food: "í´ë˜ì‹ í”¼ì", address: "7 Carmine St, New York, NY 10014"},
                { name: "Grimaldi's", food: "ë¸Œë£¨í´ë¦° í”¼ì", address: "1 Front St, Brooklyn, NY 11201"},
                { name: "Shake Shack", food: "ë²„ê±°", address: "Madison Ave & E.23rd St, New York, NY 10010"},
                { name: "Prince Street Pizza", food: "í˜í¼ë¡œë‹ˆ í”¼ì", address: "27 Prince St A, New York, NY 10012"}
            ],
            "ì„¸ê³„ì˜ ë§›": [
                { name: "The Halal Guys", food: "ì¹˜í‚¨ ì˜¤ë²„ ë¼ì´ìŠ¤", address: "W 53rd St, 6th Ave, New York, NY 10019"},
                { name: "Xi'an Famous Foods", food: "ë§¤ìš´ êµ­ìˆ˜", address: "8 St Marks Pl, New York, NY 10003"},
                { name: "Mamoun's Falafel", food: "íŒ”ë¼í ", address: "119 MacDougal St, New York, NY 10012"},
                { name: "Ippudo NY", food: "ë¼ë©˜", address: "65 4th Ave, New York, NY 10003"}
            ],
            "ì¹´í˜ & ë””ì €íŠ¸": [
                { name: "Ess-a-Bagel", food: "ë² ì´ê¸€", address: "831 3rd Ave, New York, NY 10022"},
                { name: "Junior's", food: "ì¹˜ì¦ˆì¼€ì´í¬", address: "1515 Broadway, New York, NY 10036"},
                { name: "Levain Bakery", food: "ì¿ í‚¤", address: "340 Lafayette St, New York, NY 10012"},
                { name: "Magnolia Bakery", food: "ë°”ë‚˜ë‚˜ í‘¸ë”©", address: "401 Bleecker St, New York, NY 10014"},
                { name: "Dominique Ansel", food: "í¬ë¡œë„›", address: "189 Spring St, New York, NY 10012"}
            ]
        },
        tips: [
            { title: "ë‰´ìš• ì§€í•˜ì²  (MTA) ì´ìš© íŒ", content: "OMNY(One Metro New York) ì‹œìŠ¤í…œì„ ì´ìš©í•˜ë©´ ê°€ì¥ í¸ë¦¬í•©ë‹ˆë‹¤. í•¸ë“œí° í˜ì´ë‚˜ ì»¨íƒë¦¬ìŠ¤ ì¹´ë“œë¥¼ ê°œì°°êµ¬ì— íƒ­í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤. ì¼ì£¼ì¼ ì´ìƒ ë¨¸ë¬´ë¥¸ë‹¤ë©´ 7-Day Unlimited Ride ì˜µì…˜ì„ ê³ ë ¤í•´ ë³´ì„¸ìš”. ì£¼ë§ì—ëŠ” ë…¸ì„ ì´ ë³€ê²½ë˜ëŠ” ê²½ìš°ê°€ ë§ìœ¼ë‹ˆ Citymapperë‚˜ êµ¬ê¸€ë§µ ì•±ìœ¼ë¡œ ì‹¤ì‹œê°„ ê²½ë¡œë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì…ë‹ˆë‹¤." }, { title: "íŒ(Tip) ë¬¸í™” ì´í•´í•˜ê¸°", content: "ë‰´ìš•ì˜ íŒì€ ì„ íƒì´ ì•„ë‹Œ í•„ìˆ˜ì…ë‹ˆë‹¤. ë ˆìŠ¤í† ë‘ì—ì„œëŠ” ë³´í†µ ì‹ì‚¬ ê¸ˆì•¡ì˜ 15-20%ë¥¼ íŒìœ¼ë¡œ ì§€ë¶ˆí•©ë‹ˆë‹¤. (ì„¸ê¸ˆ ì „ ê¸ˆì•¡ ê¸°ì¤€) ë°”ì—ì„œëŠ” ìŒë£Œ í•œ ì”ë‹¹ $1-2, í˜¸í…”ì—ì„œëŠ” ì§ì„ ì˜®ê²¨ì£¼ê±°ë‚˜ ë£¸ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í–ˆì„ ë•Œ $2-5 ì •ë„ì˜ íŒì„ ì£¼ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤." },
            { title: "ì•ˆì „í•˜ê²Œ ì—¬í–‰í•˜ê¸°", content: "í•­ìƒ ì£¼ë³€ì„ ì‚´í”¼ê³  ì†Œì§€í’ˆì— ì£¼ì˜í•˜ì„¸ìš”. íŠ¹íˆ íƒ€ì„ìŠ¤í€˜ì–´ë‚˜ ì§€í•˜ì²  ë“± ì‚¬ëŒì´ ë¶ë¹„ëŠ” ê³³ì—ì„œëŠ” ê°€ë°©ì„ ì•ìœ¼ë¡œ ë©”ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ë°¤ëŠ¦ê²Œ í˜¼ì ë‚¯ì„  ê³¨ëª©ì„ ë‹¤ë‹ˆëŠ” ê²ƒì€ í”¼í•˜ê³ , ê°€ëŠ¥í•œ ë°ê³  í°ê¸¸ë¡œ ë‹¤ë‹ˆì„¸ìš”. ìœ„ê¸‰ ìƒí™© ì‹œì—ëŠ” 911ë¡œ ì „í™”í•˜ì„¸ìš”." }, { title: "ê°€ê²©í‘œì™€ ì„¸ê¸ˆ", content: "ë¯¸êµ­ì˜ ê°€ê²©í‘œì—ëŠ” ëŒ€ë¶€ë¶„ ì„¸ê¸ˆ(Sales Tax)ì´ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. ë‰´ìš•ì‹œì˜ ê²½ìš°, ìƒí’ˆê³¼ ì„œë¹„ìŠ¤ì— 8.875%ì˜ ì„¸ê¸ˆì´ ì¶”ê°€ë¡œ ë¶€ê³¼ë©ë‹ˆë‹¤. ê³„ì‚° ì‹œ ìµœì¢… ê¸ˆì•¡ì´ ê°€ê²©í‘œë³´ë‹¤ ë†’ê²Œ ë‚˜ì˜¤ëŠ” ê²ƒì„ ì—¼ë‘ì— ë‘ì–´ì•¼ í•©ë‹ˆë‹¤." }
        ],
        checklist: [ { title: "ì˜ˆì•½ (~7/31)", items: [{ text: "ì‹ë‹¹/ë²„ìŠ¤/íˆ¬ì–´ ì˜ˆì•½", checked: false }, { text: "í•­ê³µê¶Œ ì˜ˆì•½ ì™„ë£Œ", checked: true }, { text: "ìˆ™ì†Œ ì˜ˆì•½ ì™„ë£Œ", checked: true }, { text: "ì—¬ê¶Œ ìœ íš¨ê¸°ê°„ í™•ì¸", checked: false }] }, { title: "ì¤€ë¹„ (~9/30)", items: [{ text: "ESTA ì‹ ì²­", checked: false }, { text: "ì—¬í–‰ì ë³´í—˜", checked: false }, { text: "í™˜ì „/í†µì‹ (Esim)", checked: false }, { text: "ì•± ì„¤ì¹˜/ê³„íš êµ¬ì²´í™”", checked: false }] }, { title: "ì¶œêµ­ (~10/23)", items: [{ text: "ì§ ì‹¸ê¸°", checked: false }, { text: "ìƒë¹„ì•½ ì¤€ë¹„ (ë©œë¼í† ë‹Œ ë“±)", checked: false }] }],
        settlements: [],
        itinerary: [
             { day: 1, date: '10/23 (ëª©)', title: 'ë‰´ìš• ë„ì°© & ë¯¸ë“œíƒ€ìš´ ì²«ì¸ìƒ', details: '<b>ì˜¤í›„:</b> JFK ê³µí•­ ë„ì°© í›„ ìˆ™ì†Œ ì´ë™ ë° ì²´í¬ì¸ (íœìŠ¤í…Œì´ì…˜ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤)<br><b>ì €ë…:</b> íƒ€ì„ìŠ¤í€˜ì–´ì˜ í™”ë ¤í•œ ê´‘ê³ íŒê³¼ ì¸íŒŒ ì†ì—ì„œ ë‰´ìš•ì˜ ì²«ë‚ ë°¤ ë§Œë½í•˜ê¸°<br><b>ì‹ì‚¬:</b> Shake Shackì—ì„œ í´ë˜ì‹í•œ ë¯¸êµ­ ë²„ê±°ë¡œ ì €ë… ì‹ì‚¬' },
            { day: 2, date: '10/24 (ê¸ˆ)', title: 'ë§¨í•´íŠ¼ì˜ ìŠ¤ì¹´ì´ë¼ì¸ê³¼ ì˜ˆìˆ ', details: '<b>ì˜¤ì „:</b> íƒ‘ ì˜¤ë¸Œ ë” ë½ ì „ë§ëŒ€ì—ì„œ ì„¼íŠ¸ëŸ´íŒŒí¬ì™€ ì— íŒŒì´ì–´ ìŠ¤í…Œì´íŠ¸ ë¹Œë”©ì´ ì–´ìš°ëŸ¬ì§„ ì „ê²½ ê°ìƒ<br><b>ì ì‹¬:</b> Ess-a-Bagelì—ì„œ ë‰´ìš• ìŠ¤íƒ€ì¼ ë² ì´ê¸€ë¡œ ë¸ŒëŸ°ì¹˜<br><b>ì˜¤í›„:</b> MoMA(í˜„ëŒ€ë¯¸ìˆ ê´€)ì—ì„œ ì•¤ë”” ì›Œí™€, í”¼ì¹´ì†Œ ë“± ê±°ì¥ë“¤ì˜ ì‘í’ˆ ê°ìƒ<br><b>ì €ë…:</b> ë¸Œë¡œë“œì›¨ì´ì—ì„œ ë®¤ì§€ì»¬ ê´€ëŒ (ë¼ì´ì˜¨ í‚¹ ì¶”ì²œ, TKTS í• ì¸ í‹°ì¼“ í™œìš©)' },
            { day: 3, date: '10/25 (í† )', title: 'ì„¼íŠ¸ëŸ´íŒŒí¬ì˜ ì—¬ìœ ì™€ ì‡¼í•‘', details: '<b>ì˜¤ì „:</b> ì„¼íŠ¸ëŸ´íŒŒí¬ì—ì„œ ìì „ê±°ë¥¼ ëŒ€ì—¬í•˜ì—¬ ê³µì› í•œ ë°”í€´ ë‘˜ëŸ¬ë³´ê¸° (ìŠ¤íŠ¸ë¡œë² ë¦¬ í•„ì¦ˆ, ë² ë°ìŠ¤ë‹¤ ë¶„ìˆ˜ ë“±)<br><b>ì ì‹¬:</b> ê³µì› ê·¼ì²˜ í‘¸ë“œíŠ¸ëŸ­ ë˜ëŠ” í™€í‘¸ë“œë§ˆì¼“ì—ì„œ ê°„ë‹¨í•˜ê²Œ í•´ê²°<br><b>ì˜¤í›„:</b> 5ë²ˆê°€(í”¼í”„ìŠ¤ ì• ë¹„ë‰´)ë¥¼ ë”°ë¼ ê±¸ìœ¼ë©° ëª…í’ˆê±°ë¦¬ ì•„ì´ì‡¼í•‘<br><b>ì €ë…:</b> ì–´í¼ ì›¨ìŠ¤íŠ¸ ì‚¬ì´ë“œì—ì„œ ë¶„ìœ„ê¸° ì¢‹ì€ ë ˆìŠ¤í† ë‘ íƒë°©' },
            { day: 4, date: '10/26 (ì¼)', title: 'ëŒ€ìì—°ì˜ ê²½ì´, ë‚˜ì´ì•„ê°€ë¼ë¡œ', details: '<b>ì˜¤ì „:</b> ì§ ë³´ê´€ì†Œì— ìºë¦¬ì–´ ë§¡ê¸´ í›„ ë‰´ìš• ê³µí•­ìœ¼ë¡œ ì´ë™<br><b>ì˜¤í›„:</b> ë²„íŒ”ë¡œ ê³µí•­ ë„ì°© í›„, ì…”í‹€ë¡œ ë‚˜ì´ì•„ê°€ë¼ í­í¬(ìºë‚˜ë‹¤ ì¸¡)ë¡œ ì´ë™<br><b>ì €ë…:</b> ë©”ë¦¬ì–´íŠ¸ í˜¸í…” ì²´í¬ì¸ í›„, ì¡°ëª…ì´ ì¼œì§„ í™˜ìƒì ì¸ í­í¬ ì•¼ê²½ ê°ìƒ. ì €ë‹ˆ ë¹„í•˜ì¸ë“œ ë” í´ìŠ¤(Journey Behind the Falls) ì²´í—˜' },
            { day: 5, date: '10/27 (ì›”)', title: 'í­í¬ ê·¼ì ‘ ì²´í—˜ & ë‰´ìš• ë³µê·€', details: '<b>ì˜¤ì „:</b> í˜¼ë¸”ë¡œì›Œ í¬ë£¨ì¦ˆ(Hornblower Cruise)ë¥¼ íƒ€ê³  í­í¬ ë°”ë¡œ ì•„ë˜ê¹Œì§€ ë‹¤ê°€ê°€ ë¬¼ë³´ë¼ ë§ê¸°<br><b>ì ì‹¬:</b> í­í¬ ì „ë§ ë ˆìŠ¤í† ë‘ì—ì„œ ì‹ì‚¬<br><b>ì˜¤í›„:</b> ë²„íŒ”ë¡œ ê³µí•­ìœ¼ë¡œ ì´ë™í•˜ì—¬ ë‰´ìš•í–‰ ë¹„í–‰ê¸° íƒ‘ìŠ¹<br><b>ì €ë…:</b> ë…¸ìŠ¤ ë²„ê² ìˆ™ì†Œ ì²´í¬ì¸ í›„ íœ´ì‹' },
            { day: 6, date: '10/28 (í™”)', title: 'ê¸ˆìœµê³¼ ì—­ì‚¬ì˜ ì¤‘ì‹¬, ë‹¤ìš´íƒ€ìš´', details: '<b>ì˜¤ì „:</b> 9/11 ë©”ëª¨ë¦¬ì–¼ & ë°•ë¬¼ê´€ ë°©ë¬¸í•˜ì—¬ ì¶”ëª¨ì˜ ì‹œê°„ì„ ê°–ê³ , ì› ì›”ë“œ ì „ë§ëŒ€ì—ì„œ ë§¨í•´íŠ¼ ì „ê²½ ê°ìƒ<br><b>ì ì‹¬:</b> ì›”ìŠ¤íŠ¸ë¦¬íŠ¸ ê·¼ì²˜ì—ì„œ ê°„ë‹¨íˆ ì‹ì‚¬<br><b>ì˜¤í›„:</b> ì›”ìŠ¤íŠ¸ë¦¬íŠ¸ì˜ ëŒì§„í•˜ëŠ” í™©ì†Œìƒê³¼ ì‚¬ì§„ ì°ê³ , íŠ¸ë¦¬ë‹ˆí‹° êµíšŒ ë°©ë¬¸<br><b>ì €ë…:</b> ì‚¬ìš°ìŠ¤ ìŠ¤íŠ¸ë¦¬íŠ¸ ì‹œí¬íŠ¸(South Street Seaport)ì—ì„œ ì €ë… ì‹ì‚¬ ë° ì•¼ê²½ ê°ìƒ' },
            { day: 7, date: '10/29 (ìˆ˜)', title: 'ììœ ì˜ ì—¬ì‹ ìƒê³¼ ë¸Œë£¨í´ë¦°ì˜ ë‚­ë§Œ', details: '<b>ì˜¤ì „:</b> ìŠ¤í…ŒíŠ¼ ì•„ì¼ëœë“œ í˜ë¦¬(ë¬´ë£Œ)ë¥¼ íƒ€ê³  ê°€ë©° ììœ ì˜ ì—¬ì‹ ìƒê³¼ ë§¨í•´íŠ¼ ìŠ¤ì¹´ì´ë¼ì¸ ì¡°ë§<br><b>ì ì‹¬:</b> ê·¸ë¦¬ë§ë”” í”¼ì ë˜ëŠ” ì¤„ë¦¬ì•„ë‚˜ í”¼ìì—ì„œ ë¸Œë£¨í´ë¦° í”¼ì ë§›ë³´ê¸°<br><b>ì˜¤í›„:</b> ë¸Œë£¨í´ë¦° ë¸Œë¦¿ì§€ë¥¼ ê±¸ì–´ì„œ ë§¨í•´íŠ¼ìœ¼ë¡œ ê±´ë„ˆì˜¤ê¸°<br><b>ì €ë…:</b> ë¤ë³´(DUMBO) í¬í†  ìŠ¤íŒŸì—ì„œ ì¸ìƒìƒ· ì°ê¸°' },
            { day: 8, date: '10/30 (ëª©)', title: 'ì²¼ì‹œì˜ ë§›ê³¼ í•˜ì´ë¼ì¸ì˜ ë©‹', details: '<b>ì˜¤ì „:</b> ì²¼ì‹œ ë§ˆì¼“ì—ì„œ ëìŠ¤í„°, íƒ€ì½” ë“± ë‹¤ì–‘í•œ ìŒì‹ìœ¼ë¡œ ë¸ŒëŸ°ì¹˜<br><b>ì˜¤í›„:</b> íì² ê¸¸ì„ ê³µì›ìœ¼ë¡œ ë§Œë“  í•˜ì´ë¼ì¸ íŒŒí¬ë¥¼ ì‚°ì±…í•˜ë©° ë„ì‹œì™€ ìì—°ì˜ ì¡°í™” ë§Œë½<br><b>ì €ë…:</b> ë¯¸íŠ¸íŒ¨í‚¹ ë””ìŠ¤íŠ¸ë¦­íŠ¸ì˜ íŠ¸ë Œë””í•œ ë£¨í”„íƒ‘ ë°”ì—ì„œ ì¹µí…Œì¼ í•œì”' },
            { day: 9, date: '10/31 (ê¸ˆ)', title: 'ğŸƒ HAPPY HALLOWEEN! ğŸƒ', details: '<b>ì˜¤ì „:</b> í• ë¡œìœˆ ì½”ìŠ¤íŠ¬ìƒµ(Abracadabra NYC ë“±) ë°©ë¬¸í•˜ì—¬ í¼ë ˆì´ë“œë¥¼ ìœ„í•œ ì˜ìƒê³¼ ì†Œí’ˆ êµ¬ë§¤<br><b>ì ì‹¬:</b> ê·¸ë¦¬ë‹ˆì¹˜ ë¹Œë¦¬ì§€ì—ì„œ ì‹ì‚¬ í›„ í¼ë ˆì´ë“œ ì¤€ë¹„<br><b>ì˜¤í›„:</b> ì›Œì‹±í„´ ìŠ¤í€˜ì–´ íŒŒí¬ ì£¼ë³€ì—ì„œ í• ë¡œìœˆ ë¶„ìœ„ê¸° ë¯¸ë¦¬ ëŠë¼ê¸°<br><b>ì €ë…:</b> ê·¸ë¦¬ë‹ˆì¹˜ ë¹Œë¦¬ì§€ í• ë¡œìœˆ í¼ë ˆì´ë“œ ì°¸ê°€ ë˜ëŠ” ê´€ëŒ! (ì €ë… 7ì‹œ ì‹œì‘, 6th Ave)<br><b>ë°¤:</b> í¼ë ˆì´ë“œ í›„, ì£¼ë³€ ë°”(Bar)ì—ì„œ ì—´ë¦¬ëŠ” í• ë¡œìœˆ íŒŒí‹° ì¦ê¸°ê¸°' },
            { day: 10, date: '11/1 (í† )', title: 'ì†Œí˜¸ ì‡¼í•‘ & ê·¸ë¦¬ë‹ˆì¹˜ ë¹Œë¦¬ì§€ íƒë°©', details: '<b>ì˜¤ì „:</b> ì†Œí˜¸(SoHo)ì˜ íŠ¹ìƒ‰ìˆëŠ” ë¶€í‹°í¬ì™€ í¸ì§‘ìƒµì—ì„œ ì‡¼í•‘<br><b>ì ì‹¬:</b> í”„ë¦°ìŠ¤ ìŠ¤íŠ¸ë¦¬íŠ¸ í”¼ìì—ì„œ í˜í¼ë¡œë‹ˆ ìŠ¤í€˜ì–´ í”¼ì ë§›ë³´ê¸°<br><b>ì˜¤í›„:</b> ê·¸ë¦¬ë‹ˆì¹˜ ë¹Œë¦¬ì§€ì˜ ì˜ˆìˆ ì ì¸ ê±°ë¦¬ì™€ ì›Œì‹±í„´ ìŠ¤í€˜ì–´ íŒŒí¬ì˜ ê°œì„ ë¬¸, ë²„ìŠ¤í‚¹ ê³µì—° ì¦ê¸°ê¸°<br><b>ì €ë…:</b> ë¸”ë£¨ë…¸íŠ¸(Blue Note) ì¬ì¦ˆ í´ëŸ½ì—ì„œ ë¼ì´ë¸Œ ê³µì—° ê°ìƒ' },
            { day: 11, date: '11/2 (ì¼)', title: 'ë¯¸êµ­ì˜ ì‹¬ì¥, ì›Œì‹±í„´ D.C.ë¡œ', details: '<b>ì˜¤ì „:</b> ë²„ìŠ¤ ë˜ëŠ” ê¸°ì°¨ë¡œ ë‰´ìš• â†’ ì›Œì‹±í„´ D.C. ì´ë™<br><b>ì˜¤í›„:</b> Yotel ì²´í¬ì¸ í›„ ë‚´ì…”ë„ ëª°(National Mall) íƒë°© ì‹œì‘<br><b>ì €ë…:</b> ë§ì»¨ ê¸°ë…ê´€, í•œêµ­ì „ ì°¸ì „ìš©ì‚¬ ê¸°ë…ë¹„, ì›Œì‹±í„´ ê¸°ë…íƒ‘ ì•¼ê²½ ê°ìƒ' },
            { day: 12, date: '11/3 (ì›”)', title: 'ë°•ë¬¼ê´€ íˆ¬ì–´ í›„ ë‰´ìš• ë³µê·€', details: '<b>ì˜¤ì „:</b> ìŠ¤ë¯¸ì†Œë‹ˆì–¸ ìì—°ì‚¬ ë°•ë¬¼ê´€ ë˜ëŠ” í•­ê³µìš°ì£¼ ë°•ë¬¼ê´€ ì§‘ì¤‘ ê´€ëŒ (ë¬´ë£Œ)<br><b>ì˜¤í›„:</b> ì›Œì‹±í„´ D.C. â†’ ë‰´ìš• ë³µê·€<br><b>ì €ë…:</b> í€¸ì¦ˆ ìˆ™ì†Œ ì²´í¬ì¸ ë° íœ´ì‹' },
            { day: 13, date: '11/4 (í™”)', title: 'ë‰´ìš•ì˜ ë˜ ë‹¤ë¥¸ ì–¼êµ´, í€¸ì¦ˆ & ë¸Œë£¨í´ë¦°', details: '<b>ì˜¤ì „:</b> í€¸ì¦ˆ í”ŒëŸ¬ì‹±ì—ì„œ ë‹¤ì–‘í•œ ì•„ì‹œì•ˆ ìŒì‹ ë§›ë³´ê¸° ë˜ëŠ” ì•„ìŠ¤í† ë¦¬ì•„ì—ì„œ ê·¸ë¦¬ìŠ¤ ë¬¸í™” ì²´í—˜<br><b>ì ì‹¬:</b> í˜„ì§€ ë§›ì§‘ì—ì„œ ì‹ì‚¬<br><b>ì˜¤í›„:</b> ë¸Œë£¨í´ë¦° ìœŒë¦¬ì—„ìŠ¤ë²„ê·¸ì˜ ë¹ˆí‹°ì§€ ìƒµê³¼ íŠ¸ë Œë””í•œ ì¹´í˜ íƒë°©<br><b>ì €ë…:</b> ìœŒë¦¬ì—„ìŠ¤ë²„ê·¸ ë¸Œë£¨ì–´ë¦¬ì—ì„œ ìˆ˜ì œ ë§¥ì£¼ ì¦ê¸°ê¸°' },
            { day: 14, date: '11/5 (ìˆ˜)', title: 'ë§ˆì§€ë§‰ ì‡¼í•‘ê³¼ ì•„ì‰¬ì›€ ë‹¬ë˜ê¸°', details: '<b>ì˜¤ì „:</b> ìš°ë“œë²„ë¦¬ ì•„ìš¸ë › ë˜ëŠ” ì‹œë‚´ ë°±í™”ì ì—ì„œ ë§ˆì§€ë§‰ ì‡¼í•‘<br><b>ì ì‹¬:</b> ê°„ë‹¨íˆ í•´ê²° í›„, ë§¨í•´íŠ¼ìœ¼ë¡œ ëŒì•„ì™€ ëª» ê°€ë³¸ ê³³ ë°©ë¬¸í•˜ê¸°<br><b>ì €ë…:</b> ì´ìŠ¤íŠ¸ ê°• í˜ë¦¬ë¥¼ íƒ€ë©° ë§¨í•´íŠ¼ ì•¼ê²½ì„ ë°°ê²½ìœ¼ë¡œ ë§ˆì§€ë§‰ ì €ë… ì‹ì‚¬ ë° ì—¬í–‰ ì •ë¦¬' },
            { day: 15, date: '11/6 (ëª©)', title: 'ì¼ìƒìœ¼ë¡œ, í•œêµ­ìœ¼ë¡œ ì¶œë°œ', details: '<b>ì˜¤ì „:</b> ê³µí•­ ì´ë™ ì „, ê°€ë²¼ìš´ ì•„ì¹¨ ì‹ì‚¬ ë° ì§ ìµœì¢… ì •ë¦¬<br><b>ë‚®:</b> JFK ê³µí•­ìœ¼ë¡œ ì´ë™<br><b>12:00:</b> ë‰´ìš• ì¶œë°œ, ì¦ê±°ì› ë˜ ì¶”ì–µì„ ì•ˆê³  í•œêµ­ìœ¼ë¡œ' }
        ]
    };
    let DATA = JSON.parse(localStorage.getItem(STORAGE_KEY)) || DEFAULT_DATA;
    const saveData = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA));

    const renderAll = () => { renderItinerary(); renderAccommodations(); renderRestaurants(); renderChecklist(); renderSettlement(); renderBudget(); renderTips(); startCountdown(); }
    const renderItinerary = () => { const c = document.getElementById('itinerary-accordion'); if (!c) return; c.innerHTML = DATA.itinerary.map(i => `<div class="border rounded-lg overflow-hidden bg-white"><div class="accordion-header flex justify-between items-center p-4 cursor-pointer"><div class="flex items-center gap-4"><span class="font-bold text-blue-600 w-8 text-center">Day ${i.day}</span><div><p class="font-bold text-lg">${i.title}</p><p class="text-sm text-gray-500">${i.date}</p></div></div><ion-icon name="chevron-down-outline" class="text-2xl transition-transform duration-300"></ion-icon></div><div class="accordion-content bg-gray-50/70"><div class="p-4 sm:p-5 border-t text-gray-700 leading-relaxed text-sm">${`<ul class="space-y-3">${i.details.split('<br>').map(l => `<li class="flex items-start"><strong class="w-16 shrink-0 text-right mr-2 text-gray-500 font-medium">${l.split(':</b>')[0].replace(/<b>/g, '')}:</strong><span class="flex-1">${l.split(':</b>')[1]}</span></li>`).join('')}</ul>`}</div></div></div>`).join(''); };
    const renderAccommodations = () => { const c = document.getElementById('accommodation-list'); if (!c) return; c.innerHTML = DATA.accommodations.map((item, index) => `<div class="bg-gray-50 p-4 rounded-lg border"><div class="flex flex-wrap justify-between items-start gap-2"><div><p class="font-bold" contenteditable="true" data-prop="name" data-index="${index}">${item.name}</p><input type="text" placeholder="ì£¼ì†Œ ì…ë ¥..." class="text-sm text-gray-600 w-full mt-1 p-2 border rounded-md" value="${item.address}" data-prop="address" data-index="${index}" style="min-width: 250px;"><p class="text-sm text-gray-600 mt-2">${item.dates} | ì´ ${item.price.toLocaleString('ko-KR')}ì›</p><p class="text-sm text-blue-600 font-semibold">ì¸ë‹¹ ${(item.price / 2).toLocaleString('ko-KR')}ì›</p></div><button class="status-toggle ${item.booked ? 'paid' : 'pending'}" data-index="${index}">${item.booked ? 'ì˜ˆì•½ ì™„ë£Œ' : 'ì˜ˆì•½ ì˜ˆì •'}</button></div><div class="mt-3"><input type="text" placeholder="ì²´í¬ì¸ ì‹œê°„, íŠ¹ì´ì‚¬í•­ ë“± ë©”ëª¨" class="w-full p-2 border rounded-md text-sm focus:ring-2 focus:ring-blue-500" value="${item.memo}" data-prop="memo" data-index="${index}"></div></div>`).join(''); };
    const renderRestaurants = () => {
        const container = document.getElementById('restaurant-accordion-container'); if (!container) return;
        let html = '';
        for (const category in DATA.restaurants) {
            html += `<div class="border rounded-lg overflow-hidden bg-white">
                <div class="accordion-header flex justify-between items-center p-4 cursor-pointer">
                    <h4 class="font-bold text-lg">${category}</h4>
                    <ion-icon name="chevron-down-outline" class="text-2xl transition-transform duration-300"></ion-icon>
                </div>
                <div class="accordion-content bg-gray-50/70">
                    <div class="p-2 sm:p-4 border-t">
                        <table class="w-full text-left text-sm">
                            <thead><tr class="border-b"><th class="p-2">ë§›ì§‘</th><th class="p-2">ì¢…ë¥˜</th><th class="p-2 hidden md:table-cell">ì£¼ì†Œ</th><th class="p-2 text-center">ì§€ë„</th></tr></thead>
                            <tbody>${DATA.restaurants[category].map(r => `
                                <tr class="border-t">
                                    <td class="p-2 font-semibold">${r.name}</td>
                                    <td class="p-2">${r.food}</td>
                                    <td class="p-2 hidden md:table-cell">${r.address}</td>
                                    <td class="p-2 text-center"><a href="https://maps.google.com/?q=${encodeURIComponent(r.name + ", New York")}" target="_blank" class="text-blue-500"><ion-icon name="map-outline" class="text-xl"></ion-icon></a></td>
                                </tr>`).join('')}</tbody>
                        </table>
                    </div>
                </div>
            </div>`;
        }
        container.innerHTML = html;
    };
    const renderTips = () => { const c = document.getElementById('tips-list'); if (!c) return; c.innerHTML = DATA.tips.map(tip => `<div class="bg-gray-50 p-4 rounded-lg border"><h4 class="font-bold text-lg mb-2">${tip.title}</h4><p class="text-sm text-gray-700 leading-6">${tip.content}</p></div>`).join(''); }
    const renderChecklist = () => { const c = document.getElementById('checklist-container'); if (!c) return; c.innerHTML = DATA.checklist.map((section, sIdx) => `<div class="bg-gray-50 p-4 rounded-lg checklist-section relative"><div class="flex justify-between items-center mb-2"><h4 class="font-bold editable-title" contenteditable="true" data-section-index="${sIdx}">${section.title}</h4><button class="delete-section-btn text-gray-400 hover:text-red-500" data-section-index="${sIdx}"><ion-icon name="close-circle-outline"></ion-icon></button></div><ul class="space-y-2 text-sm">${section.items.map((item, iIdx) => `<li class="checklist-item flex items-center justify-between"><label class="flex items-center flex-grow"><input type="checkbox" class="mr-2" ${item.checked?'checked':''} data-section-index="${sIdx}" data-item-index="${iIdx}"><span class="checklist-item-text" contenteditable="true" data-section-index="${sIdx}" data-item-index="${iIdx}">${item.text}</span></label><button class="delete-btn text-gray-400 hover:text-red-500 text-xs" data-section-index="${sIdx}" data-item-index="${iIdx}"><ion-icon name="remove-circle-outline"></ion-icon></button></li>`).join('')}</ul><button class="add-item-btn mt-3 text-xs text-blue-500 font-semibold" data-section-index="${sIdx}">+ í•­ëª© ì¶”ê°€</button></div>`).join(''); };
    const renderBudget = () => { const c = document.querySelector('#budget-table tbody'); if (!c) return; c.innerHTML = DATA.budget.map((b, index) => { if (b.status === 'special') return `<tr class="border-b"><td class="p-3">${b.item}</td><td class="p-3 text-right">+ Î±</td><td class="p-3 text-center"><span class="text-sm text-gray-500">ë³„ë„ ê³„ì‚°</span></td></tr>`; return `<tr class="border-b"><td class="p-3" contenteditable="true" data-index="${index}" data-prop="item">${b.item}</td><td class="p-3 text-right cost-cell" contenteditable="true" data-index="${index}" data-prop="cost">${b.cost.toLocaleString('ko-KR')}</td><td class="p-3 text-center"><button class="status-toggle ${b.status}" data-index="${index}">${b.status === 'paid' ? 'ê²°ì œ ì™„ë£Œ' : 'ì§€ì¶œ ì˜ˆì •'}</button></td></tr>`; }).join(''); updateTotal(); };
    const renderSettlement = () => {
        const listC = document.getElementById('settlement-list'), summaryC = document.getElementById('settlement-summary'), payerSelect = document.getElementById('settlement-payer');
        if (!listC || !summaryC || !payerSelect) return;
        
        payerSelect.innerHTML = `<option value="user1">${DATA.user1Name.substring(1)}ê°€ ëƒ„</option><option value="user2">${DATA.user2Name.substring(1)}ê°€ ëƒ„</option>`;
        
        listC.innerHTML = DATA.settlements.map((item, index) => `<tr class="settlement-item ${item.payer === 'user1' ? 'user1-payment-row' : 'user2-payment-row'}"><td class="p-2">${item.date}</td><td class="p-2">${item.desc}</td><td class="p-2 text-right">$${item.amount.toLocaleString('en-US')}</td><td class="p-2 text-center">${item.payer === 'user1' ? `${DATA.user1Name.substring(1)}ê°€ ëƒ„` : `${DATA.user2Name.substring(1)}ê°€ ëƒ„`}</td><td class="p-2 text-right"><button class="delete-btn text-gray-400 hover:text-red-500" data-index="${index}"><ion-icon name="trash-outline"></ion-icon></button></td></tr>`).join('');
        const total = DATA.settlements.reduce((s, i) => s + i.amount, 0), user1Spent = DATA.settlements.filter(i => i.payer === 'user1').reduce((s, i) => s + i.amount, 0), toSettle = (total / 2) - user1Spent, toSettleKrw = toSettle * USD_TO_KRW;
        summaryC.innerHTML = `<div class="bg-white p-3 rounded-lg shadow-sm"><p class="text-xs text-gray-500">ì´ ê³µë™ê²½ë¹„</p><p class="font-bold">$${total.toLocaleString('en-US')}</p><p class="text-xs text-gray-500">~ â‚©${(total * USD_TO_KRW).toLocaleString('ko-KR')}</p></div><div class="bg-white p-3 rounded-lg shadow-sm"><p class="text-xs text-gray-500">ì •ì‚°í•  ê¸ˆì•¡</p><p class="font-bold text-red-600">${toSettle === 0 ? 'ì •ì‚° ì™„ë£Œ' : toSettle > 0 ? `${DATA.user1Name.substring(1)}ê°€ ì¤˜ì•¼í•¨` : `${DATA.user2Name.substring(1)}ê°€ ì¤˜ì•¼í•¨`}</p><p class="text-sm font-semibold text-red-600">${toSettle === 0 ? '' : `$${Math.abs(toSettle).toLocaleString('en-US')} (â‚©${Math.abs(toSettleKrw).toLocaleString('ko-KR')})`}</p></div>`;
    };
    const updateTotal = () => { const totalEl = document.getElementById('total-cost'); if (!totalEl) return; const total = DATA.budget.filter(b=>b.status !== 'special').reduce((s, i) => s + i.cost, 0); totalEl.innerText = `â‚©${total.toLocaleString('ko-KR')} + Î±`; };
    const startCountdown = () => { const countDownDate = new Date("Oct 23, 2025 10:00:00").getTime(); const D = document.getElementById("days"); if(!D) return; const interval = setInterval(() => { const now = new Date().getTime(), distance = countDownDate - now; if (distance < 0) { clearInterval(interval); document.getElementById("countdown-container").innerHTML = `<div class="text-3xl font-bold">ğŸ‰ ENJOY YOUR TRIP! ğŸ‰</div>`; return; } D.textContent = Math.floor(distance / 86400000); const H = document.getElementById("hours"), M = document.getElementById("minutes"), S = document.getElementById("seconds"); if (H) H.parentElement.style.display = 'none'; if (M) M.parentElement.style.display = 'none'; if(S) S.parentElement.style.display = 'none'; document.querySelector('#countdown-container').classList.replace('md:grid-cols-4', 'grid-cols-1'); document.querySelector('#countdown-container').classList.replace('gap-4', 'gap-0'); }, 1000); };
    
    document.addEventListener('DOMContentLoaded', () => {
        renderAll();
        document.body.addEventListener('click', e => {
            const target = e.target;
            const button = target.closest('button');
            if (target.closest('.accordion-header')) {
                const header = target.closest('.accordion-header');
                const content = header.nextElementSibling;
                const icon = header.querySelector('ion-icon');
                if (content.style.maxHeight) { content.style.maxHeight = null; icon.style.transform = 'rotate(0deg)'; } 
                else { content.style.maxHeight = content.scrollHeight + "px"; icon.style.transform = 'rotate(180deg)'; }
            } else if (button) {
                if (button.closest('.tab-button')) {
                    const tabName = button.dataset.tab;
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
                    document.getElementById(tabName)?.classList.remove('hidden');
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                } else if (button.matches('.status-toggle')) {
                    const index = button.dataset.index;
                    if(button.closest('#budget-table')) { DATA.budget[index].status = DATA.budget[index].status === 'pending' ? 'paid' : 'pending'; renderBudget(); } 
                    else { DATA.accommodations[index].booked = !DATA.accommodations[index].booked; renderAccommodations(); }
                    saveData();
                } else if (button.id === 'add-checklist-section-btn') {
                    const title = prompt("ìƒˆë¡œìš´ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ ì œëª©:", "ìƒˆë¡œìš´ ëª©ë¡");
                    if (title) { DATA.checklist.push({ title, items: [] }); renderChecklist(); saveData(); }
                } else if (button.matches('.add-item-btn')) {
                    DATA.checklist[button.dataset.sectionIndex].items.push({ text: "ìƒˆ í•­ëª©", checked: false });
                    renderChecklist(); saveData();
                } else if (button.matches('.delete-btn') || button.matches('.delete-section-btn')) {
                    const sIdx = button.dataset.sectionIndex, iIdx = button.dataset.itemIndex;
                    if (iIdx) { DATA.checklist[sIdx].items.splice(iIdx, 1); } 
                    else { if (confirm(`'${DATA.checklist[sIdx].title}' ì„¹ì…˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) DATA.checklist.splice(sIdx, 1); }
                    renderChecklist(); saveData();
                } else if (button.closest('#settlement-list [data-index]')) {
                     const index = button.closest('[data-index]').dataset.index;
                     DATA.settlements.splice(index, 1);
                     renderSettlement(); saveData();
                }
            }
        });

        document.body.addEventListener('focusout', e => {
            const target = e.target;
            const index = target.dataset.index;
            if (target.matches('#accommodation-list [data-prop]')) {
                DATA.accommodations[index][target.dataset.prop] = target.value || target.innerText;
            } else if (target.matches('#budget-table [contenteditable]')) {
                const prop = target.dataset.prop, value = prop === 'cost' ? parseFloat(target.innerText.replace(/,/g, '')) || 0 : target.innerText;
                DATA.budget[index][prop] = value;
                renderBudget();
            } else if (target.matches('.editable-title')) {
                DATA.checklist[target.dataset.sectionIndex].title = target.innerText;
            } else if (target.matches('.checklist-item-text')) {
                DATA.checklist[target.dataset.sectionIndex].items[target.dataset.itemIndex].text = target.innerText;
            } else { return; }
            saveData();
        });

        document.body.addEventListener('change', e => {
            const target = e.target;
            if (target.matches('.checklist-item input[type="checkbox"]')) {
                DATA.checklist[target.dataset.sectionIndex].items[target.dataset.itemIndex].checked = target.checked;
                saveData();
            }
        });
        
        document.getElementById('settlement-form')?.addEventListener('submit', e => {
            e.preventDefault();
            const form = e.target;
            DATA.settlements.push({ date: form.querySelector('#settlement-date').value, desc: form.querySelector('#settlement-desc').value, amount: parseFloat(form.querySelector('#settlement-amount').value), payer: form.querySelector('#settlement-payer').value });
            renderSettlement(); saveData(); form.reset();
            form.querySelector('#settlement-date').valueAsDate = new Date();
        });
        
        const dateInput = document.getElementById('settlement-date');
        if(dateInput) dateInput.valueAsDate = new Date();
    });
    </script>
</body>
</html>
