<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>뉴욕 여행 🇺🇸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <style>
        body { font-family: 'Noto Sans KR', 'Inter', sans-serif; scroll-behavior: smooth; }
        .section-title { font-family: 'Noto Sans KR', sans-serif; font-weight: 900; }
        .header-title { text-shadow: 0 0 8px rgba(255, 255, 255, 0.4), 3px 3px 8px rgba(0, 0, 0, 0.8); }
        .tab-button.active { color: #2563eb; border-bottom-color: #2563eb; font-weight: 700; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out; }
        [contenteditable]:focus { outline: 2px solid #3b82f6; background-color: #eff6ff; border-radius: 4px; }
        .timeline-item { position: relative; padding-left: 3rem; padding-bottom: 2.5rem; }
        .timeline-item:last-child { padding-bottom: 0; }
        .timeline-item::before { content: ''; position: absolute; left: calc(1rem - 1px); top: 1.5rem; bottom: -1.5rem; width: 2px; background-color: #e5e7eb; }
        .timeline-item:last-child::before { display: none; }
        .timeline-icon { position: absolute; left: 0; top: 0.5rem; width: 2rem; height: 2rem; display: flex; align-items: center; justify-content: center; border-radius: 50%; background-color: white; border: 2px solid #e5e7eb; }
        .delete-btn { opacity: 0; transition: opacity 0.2s; }
        .checklist-section:hover .delete-section-btn, .checklist-item:hover .delete-btn, .settlement-item:hover .delete-btn { opacity: 1; }
        .status-toggle { cursor: pointer; padding: 4px 10px; border-radius: 9999px; font-size: 0.8rem; font-weight: 500; transition: all 0.2s; }
        .status-toggle.pending { background-color: #fee2e2; color: #b91c1c; }
        .status-toggle.paid { background-color: #dcfce7; color: #166534; }
        .user1-payment-row { background-color: #eff6ff; }
        .user2-payment-row { background-color: #f0fdf4; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="relative bg-white shadow-md">
        <div class="absolute inset-0"><img src="https://upload.wikimedia.org/wikipedia/commons/4/47/New_york_times_square-terabass.jpg" class="w-full h-full object-cover" alt="New York Times Square"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-black/20"></div>
        <div class="relative max-w-7xl mx-auto pt-20 pb-10 px-4 text-center text-white"><h1 class="text-4xl md:text-6xl font-extrabold tracking-tight section-title header-title">뉴욕 여행 🇺🇸</h1><p class="mt-4 text-xl md:text-2xl font-semibold header-title">2025. 10. 23 (목) - 2025. 11. 06 (목)</p></div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div id="countdown" class="my-6"><div class="relative rounded-lg p-4 flex items-center justify-center text-white bg-gray-800/70 backdrop-blur-sm shadow-xl"><div id="countdown-container" class="text-center"><div class="text-5xl sm:text-6xl font-bold" id="days">0</div><p class="mt-1 text-sm font-semibold">DAYS LEFT</p></div></div></div>
        
        <div class="bg-white rounded-t-lg shadow-lg border-b border-gray-200 sticky top-0 z-20">
            <nav class="flex justify-around flex-wrap" id="main-tabs">
                <button data-tab="overview" class="tab-button active w-1/3 md:w-auto flex-grow py-4 px-2 text-center border-b-2 border-transparent text-xs sm:text-base transition">개요</button>
                <button data-tab="itinerary" class="tab-button w-1/3 md:w-auto flex-grow py-4 px-2 text-center border-b-2 border-transparent text-xs sm:text-base transition">상세 일정</button>
                <button data-tab="accommodation" class="tab-button w-1/3 md:w-auto flex-grow py-4 px-2 text-center border-b-2 border-transparent text-xs sm:text-base transition">숙소</button>
                <button data-tab="settlement" class="tab-button w-1/3 md:w-auto flex-grow py-4 px-2 text-center border-b-2 border-transparent text-xs sm:text-base transition">정산/준비</button>
                <button data-tab="info" class="tab-button w-1/3 md:w-auto flex-grow py-4 px-2 text-center border-b-2 border-transparent text-xs sm:text-base transition">맛집/정보</button>
            </nav>
        </div>

        <main class="bg-white rounded-b-lg shadow-lg p-4 sm:p-8">
            <div id="overview" class="tab-content"><h2 class="section-title text-3xl font-bold mb-8">🗺️ 여행 개요</h2><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="bg-gray-50 p-6 rounded-lg"><h3 class="font-bold text-xl mb-6">이동 경로</h3><div class="timeline"><div class="timeline-item"><div class="timeline-icon"><ion-icon name="business-outline" class="text-xl text-blue-500"></ion-icon></div><div><p class="text-sm text-gray-500">10/23 - 10/26</p><strong class="text-lg">뉴욕 (미드타운)</strong></div></div><div class="timeline-item"><div class="timeline-icon"><ion-icon name="water-outline" class="text-xl text-cyan-500"></ion-icon></div><div><p class="text-sm text-gray-500">10/26 - 10/27</p><strong class="text-lg">나이아가라</strong></div></div><div class="timeline-item"><div class="timeline-icon"><ion-icon name="business-outline" class="text-xl text-blue-500"></ion-icon></div><div><p class="text-sm text-gray-500">10/27 - 11/02</p><strong class="text-lg">뉴욕 (다운타운)</strong></div></div><div class="timeline-item"><div class="timeline-icon"><ion-icon name="flag-outline" class="text-xl text-red-500"></ion-icon></div><div><p class="text-sm text-gray-500">11/02 - 11/03</p><strong class="text-lg">워싱턴 D.C.</strong></div></div><div class="timeline-item"><div class="timeline-icon"><ion-icon name="business-outline" class="text-xl text-blue-500"></ion-icon></div><div><p class="text-sm text-gray-500">11/03 - 11/06</p><strong class="text-lg">뉴욕 (퀸즈)</strong></div></div></div></div><div class="bg-gray-50 p-6 rounded-lg flex flex-col"><h3 class="font-bold text-xl mb-4">내 여행 지도</h3><div class="flex-grow w-full h-full min-h-[300px] rounded-md overflow-hidden"><iframe src="https://www.google.com/maps/d/embed?mid=1U-2rTW6OfqgexwLOz_B7zhMLDacTHQw" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe></div></div></div></div>
            <div id="itinerary" class="tab-content hidden"><h2 class="section-title text-3xl font-bold mb-6">🗓️ 상세 일정</h2><div class="space-y-4" id="itinerary-accordion"></div></div>
            <div id="accommodation" class="tab-content hidden"><h2 class="section-title text-3xl font-bold mb-6">🏨 숙소 정보</h2><div class="space-y-4" id="accommodation-list"></div></div>
            <div id="settlement" class="tab-content hidden"><h2 class="section-title text-3xl font-bold mb-6">📊 정산 및 준비물 관리</h2><div class="mb-12"><h3 class="font-bold text-xl mb-4 flex items-center gap-2"><ion-icon name="calculator-outline"></ion-icon>공동 경비 정산</h3><div class="bg-gray-50 p-4 rounded-lg"><form id="settlement-form" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-3 items-end mb-4"><input type="date" id="settlement-date" class="p-2 border rounded-md text-sm" required><input type="text" id="settlement-desc" placeholder="내용" class="p-2 border rounded-md text-sm sm:col-span-2" required><input type="number" id="settlement-amount" placeholder="금액 ($)" class="p-2 border rounded-md text-sm" step="0.01" required><div class="grid grid-cols-2 gap-2"><select id="settlement-payer" class="p-2 border rounded-md text-sm"></select><button type="submit" class="bg-blue-500 text-white font-semibold p-2 rounded-md hover:bg-blue-600 transition">추가</button></div></form><div class="overflow-x-auto mb-4"><table class="w-full text-left text-sm whitespace-nowrap"><thead class="border-b"><th class="p-2">날짜</th><th class="p-2">내용</th><th class="p-2 text-right">금액</th><th class="p-2 text-center">결제자</th><th class="p-2 text-right"></th></thead><tbody id="settlement-list"></tbody></table></div><div id="settlement-summary" class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-center"></div></div></div><div class="mb-12"><h3 class="font-bold text-xl mb-4 flex items-center gap-2"><ion-icon name="cash-outline"></ion-icon>예산 계획 (1인 기준)</h3><div class="overflow-x-auto bg-gray-50 p-4 rounded-lg"><table class="w-full text-left" id="budget-table"><thead><tr class="border-b"><th class="p-3">항목</th><th class="p-3 text-right">예상 비용 (₩)</th><th class="p-3 text-center">상태</th></tr></thead><tbody></tbody><tfoot class="bg-gray-200"><tr><td class="p-3 font-extrabold text-lg">합계</td><td id="total-cost" class="p-3 text-right font-extrabold text-lg" colspan="2">₩0 + α</td></tr></tfoot></table></div></div><div><div class="flex justify-between items-center mb-4"><h3 class="font-bold text-xl flex items-center gap-2"><ion-icon name="checkmark-done-outline"></ion-icon>체크리스트</h3><button id="add-checklist-section-btn" class="text-sm bg-blue-500 text-white font-semibold py-1 px-3 rounded-md hover:bg-blue-600 transition">+ 섹션 추가</button></div><div id="checklist-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div></div></div>
            <div id="info" class="tab-content hidden"><h2 class="section-title text-3xl font-bold mb-6">🍽️ 맛집 및 정보</h2><div class="mb-12"><h3 class="font-bold text-xl mb-4 flex items-center gap-2"><ion-icon name="restaurant-outline"></ion-icon>뉴욕 추천 맛집</h3><div id="restaurant-accordion-container" class="space-y-2"></div></div><div><h3 class="font-bold text-xl mb-4 flex items-center gap-2"><ion-icon name="information-circle-outline"></ion-icon>유용한 여행 정보</h3><div class="space-y-4" id="tips-list"></div></div></div>
        </main>
    </div>

    <footer class="bg-gray-200 mt-12 py-6"><div class="max-w-7xl mx-auto px-4 text-center text-gray-600"><p>© 2025 US Trip Planner. All rights reserved.</p></div></footer>
    
    <script>
    const STORAGE_KEY = 'us_trip_data_v16';
    const USD_TO_KRW = 1380;
    const DEFAULT_DATA = {
        user1Name: "김용하",
        user2Name: "진유영",
        budget: [
            { item: "항공권", cost: 1370000, status: 'paid' }, { item: "숙박비 (N빵기준)", cost: 1465704, status: 'pending' },
            { item: "교통비", cost: 500000, status: 'pending' }, { item: "식비", cost: 2000000, status: 'pending' },
            { item: "관광/액티비티", cost: 600000, status: 'pending' }, { item: "쇼핑", cost: 0, status: 'special' }
        ],
        accommodations: [
            { dates: '10/23-26', name: '펜스테이션 게스트하우스', price: 591408, booked: true, address: "408 8th Ave, New York, NY 10001", memo: "" },
            { dates: '10/26-27', name: '메리어트 나이아가라폴스뷰', price: 350000, booked: true, address: "6700 Fallsview Blvd, Niagara Falls, ON L2G 3W6", memo: "" },
            { dates: '10/27-11/2', name: 'North Bergen 에어비앤비', price: 1030000, booked: true, address: "6814 Smith Ave, North Bergen, NJ 07047", memo: "" },
            { dates: '11/2-3', name: 'Yotel 워싱턴 D.C.', price: 240000, booked: true, address: "415 New Jersey Ave NW, Washington, DC 20001", memo: "" },
            { dates: '11/3-6', name: '뉴욕 퀸즈 에어비앤비', price: 720000, booked: false, address: "Queens, NY", memo: "" },
        ],
        restaurants: {
            "뉴욕 클래식": [
                { name: "Peter Luger", food: "스테이크", address: "178 Broadway, Brooklyn, NY 11211"},
                { name: "Katz's Deli", food: "파스트라미", address: "205 E Houston St, New York, NY 10002"},
                { name: "Balthazar", food: "프렌치 비스트로", address: "80 Spring St, New York, NY 10012"},
                { name: "Keens Steakhouse", food: "스테이크", address: "72 W 36th St, New York, NY 10018"}
            ],
            "피자 & 샌드위치": [
                { name: "Joe's Pizza", food: "클래식 피자", address: "7 Carmine St, New York, NY 10014"},
                { name: "Grimaldi's", food: "브루클린 피자", address: "1 Front St, Brooklyn, NY 11201"},
                { name: "Shake Shack", food: "버거", address: "Madison Ave & E.23rd St, New York, NY 10010"},
                { name: "Prince Street Pizza", food: "페퍼로니 피자", address: "27 Prince St A, New York, NY 10012"}
            ],
            "세계의 맛": [
                { name: "The Halal Guys", food: "치킨 오버 라이스", address: "W 53rd St, 6th Ave, New York, NY 10019"},
                { name: "Xi'an Famous Foods", food: "매운 국수", address: "8 St Marks Pl, New York, NY 10003"},
                { name: "Mamoun's Falafel", food: "팔라펠", address: "119 MacDougal St, New York, NY 10012"},
                { name: "Ippudo NY", food: "라멘", address: "65 4th Ave, New York, NY 10003"}
            ],
            "카페 & 디저트": [
                { name: "Ess-a-Bagel", food: "베이글", address: "831 3rd Ave, New York, NY 10022"},
                { name: "Junior's", food: "치즈케이크", address: "1515 Broadway, New York, NY 10036"},
                { name: "Levain Bakery", food: "쿠키", address: "340 Lafayette St, New York, NY 10012"},
                { name: "Magnolia Bakery", food: "바나나 푸딩", address: "401 Bleecker St, New York, NY 10014"},
                { name: "Dominique Ansel", food: "크로넛", address: "189 Spring St, New York, NY 10012"}
            ]
        },
        tips: [
            { title: "뉴욕 지하철 (MTA) 이용 팁", content: "OMNY(One Metro New York) 시스템을 이용하면 가장 편리합니다. 핸드폰 페이나 컨택리스 카드를 개찰구에 탭하기만 하면 됩니다. 일주일 이상 머무른다면 7-Day Unlimited Ride 옵션을 고려해 보세요. 주말에는 노선이 변경되는 경우가 많으니 Citymapper나 구글맵 앱으로 실시간 경로를 확인하는 것이 필수입니다." }, { title: "팁(Tip) 문화 이해하기", content: "뉴욕의 팁은 선택이 아닌 필수입니다. 레스토랑에서는 보통 식사 금액의 15-20%를 팁으로 지불합니다. (세금 전 금액 기준) 바에서는 음료 한 잔당 $1-2, 호텔에서는 짐을 옮겨주거나 룸서비스를 이용했을 때 $2-5 정도의 팁을 주는 것이 일반적입니다." },
            { title: "안전하게 여행하기", content: "항상 주변을 살피고 소지품에 주의하세요. 특히 타임스퀘어나 지하철 등 사람이 붐비는 곳에서는 가방을 앞으로 메는 것이 좋습니다. 밤늦게 혼자 낯선 골목을 다니는 것은 피하고, 가능한 밝고 큰길로 다니세요. 위급 상황 시에는 911로 전화하세요." }, { title: "가격표와 세금", content: "미국의 가격표에는 대부분 세금(Sales Tax)이 포함되어 있지 않습니다. 뉴욕시의 경우, 상품과 서비스에 8.875%의 세금이 추가로 부과됩니다. 계산 시 최종 금액이 가격표보다 높게 나오는 것을 염두에 두어야 합니다." }
        ],
        checklist: [ { title: "예약 (~7/31)", items: [{ text: "식당/버스/투어 예약", checked: false }, { text: "항공권 예약 완료", checked: true }, { text: "숙소 예약 완료", checked: true }, { text: "여권 유효기간 확인", checked: false }] }, { title: "준비 (~9/30)", items: [{ text: "ESTA 신청", checked: false }, { text: "여행자 보험", checked: false }, { text: "환전/통신(Esim)", checked: false }, { text: "앱 설치/계획 구체화", checked: false }] }, { title: "출국 (~10/23)", items: [{ text: "짐 싸기", checked: false }, { text: "상비약 준비 (멜라토닌 등)", checked: false }] }],
        settlements: [],
        itinerary: [
             { day: 1, date: '10/23 (목)', title: '뉴욕 도착 & 미드타운 첫인상', details: '<b>오후:</b> JFK 공항 도착 후 숙소 이동 및 체크인 (펜스테이션 게스트하우스)<br><b>저녁:</b> 타임스퀘어의 화려한 광고판과 인파 속에서 뉴욕의 첫날밤 만끽하기<br><b>식사:</b> Shake Shack에서 클래식한 미국 버거로 저녁 식사' },
            { day: 2, date: '10/24 (금)', title: '맨해튼의 스카이라인과 예술', details: '<b>오전:</b> 탑 오브 더 락 전망대에서 센트럴파크와 엠파이어 스테이트 빌딩이 어우러진 전경 감상<br><b>점심:</b> Ess-a-Bagel에서 뉴욕 스타일 베이글로 브런치<br><b>오후:</b> MoMA(현대미술관)에서 앤디 워홀, 피카소 등 거장들의 작품 감상<br><b>저녁:</b> 브로드웨이에서 뮤지컬 관람 (라이온 킹 추천, TKTS 할인 티켓 활용)' },
            { day: 3, date: '10/25 (토)', title: '센트럴파크의 여유와 쇼핑', details: '<b>오전:</b> 센트럴파크에서 자전거를 대여하여 공원 한 바퀴 둘러보기 (스트로베리 필즈, 베데스다 분수 등)<br><b>점심:</b> 공원 근처 푸드트럭 또는 홀푸드마켓에서 간단하게 해결<br><b>오후:</b> 5번가(피프스 애비뉴)를 따라 걸으며 명품거리 아이쇼핑<br><b>저녁:</b> 어퍼 웨스트 사이드에서 분위기 좋은 레스토랑 탐방' },
            { day: 4, date: '10/26 (일)', title: '대자연의 경이, 나이아가라로', details: '<b>오전:</b> 짐 보관소에 캐리어 맡긴 후 뉴욕 공항으로 이동<br><b>오후:</b> 버팔로 공항 도착 후, 셔틀로 나이아가라 폭포(캐나다 측)로 이동<br><b>저녁:</b> 메리어트 호텔 체크인 후, 조명이 켜진 환상적인 폭포 야경 감상. 저니 비하인드 더 폴스(Journey Behind the Falls) 체험' },
            { day: 5, date: '10/27 (월)', title: '폭포 근접 체험 & 뉴욕 복귀', details: '<b>오전:</b> 혼블로워 크루즈(Hornblower Cruise)를 타고 폭포 바로 아래까지 다가가 물보라 맞기<br><b>점심:</b> 폭포 전망 레스토랑에서 식사<br><b>오후:</b> 버팔로 공항으로 이동하여 뉴욕행 비행기 탑승<br><b>저녁:</b> 노스 버겐 숙소 체크인 후 휴식' },
            { day: 6, date: '10/28 (화)', title: '금융과 역사의 중심, 다운타운', details: '<b>오전:</b> 9/11 메모리얼 & 박물관 방문하여 추모의 시간을 갖고, 원 월드 전망대에서 맨해튼 전경 감상<br><b>점심:</b> 월스트리트 근처에서 간단히 식사<br><b>오후:</b> 월스트리트의 돌진하는 황소상과 사진 찍고, 트리니티 교회 방문<br><b>저녁:</b> 사우스 스트리트 시포트(South Street Seaport)에서 저녁 식사 및 야경 감상' },
            { day: 7, date: '10/29 (수)', title: '자유의 여신상과 브루클린의 낭만', details: '<b>오전:</b> 스테튼 아일랜드 페리(무료)를 타고 가며 자유의 여신상과 맨해튼 스카이라인 조망<br><b>점심:</b> 그리말디 피자 또는 줄리아나 피자에서 브루클린 피자 맛보기<br><b>오후:</b> 브루클린 브릿지를 걸어서 맨해튼으로 건너오기<br><b>저녁:</b> 덤보(DUMBO) 포토 스팟에서 인생샷 찍기' },
            { day: 8, date: '10/30 (목)', title: '첼시의 맛과 하이라인의 멋', details: '<b>오전:</b> 첼시 마켓에서 랍스터, 타코 등 다양한 음식으로 브런치<br><b>오후:</b> 폐철길을 공원으로 만든 하이라인 파크를 산책하며 도시와 자연의 조화 만끽<br><b>저녁:</b> 미트패킹 디스트릭트의 트렌디한 루프탑 바에서 칵테일 한잔' },
            { day: 9, date: '10/31 (금)', title: '🎃 HAPPY HALLOWEEN! 🎃', details: '<b>오전:</b> 할로윈 코스튬샵(Abracadabra NYC 등) 방문하여 퍼레이드를 위한 의상과 소품 구매<br><b>점심:</b> 그리니치 빌리지에서 식사 후 퍼레이드 준비<br><b>오후:</b> 워싱턴 스퀘어 파크 주변에서 할로윈 분위기 미리 느끼기<br><b>저녁:</b> 그리니치 빌리지 할로윈 퍼레이드 참가 또는 관람! (저녁 7시 시작, 6th Ave)<br><b>밤:</b> 퍼레이드 후, 주변 바(Bar)에서 열리는 할로윈 파티 즐기기' },
            { day: 10, date: '11/1 (토)', title: '소호 쇼핑 & 그리니치 빌리지 탐방', details: '<b>오전:</b> 소호(SoHo)의 특색있는 부티크와 편집샵에서 쇼핑<br><b>점심:</b> 프린스 스트리트 피자에서 페퍼로니 스퀘어 피자 맛보기<br><b>오후:</b> 그리니치 빌리지의 예술적인 거리와 워싱턴 스퀘어 파크의 개선문, 버스킹 공연 즐기기<br><b>저녁:</b> 블루노트(Blue Note) 재즈 클럽에서 라이브 공연 감상' },
            { day: 11, date: '11/2 (일)', title: '미국의 심장, 워싱턴 D.C.로', details: '<b>오전:</b> 버스 또는 기차로 뉴욕 → 워싱턴 D.C. 이동<br><b>오후:</b> Yotel 체크인 후 내셔널 몰(National Mall) 탐방 시작<br><b>저녁:</b> 링컨 기념관, 한국전 참전용사 기념비, 워싱턴 기념탑 야경 감상' },
            { day: 12, date: '11/3 (월)', title: '박물관 투어 후 뉴욕 복귀', details: '<b>오전:</b> 스미소니언 자연사 박물관 또는 항공우주 박물관 집중 관람 (무료)<br><b>오후:</b> 워싱턴 D.C. → 뉴욕 복귀<br><b>저녁:</b> 퀸즈 숙소 체크인 및 휴식' },
            { day: 13, date: '11/4 (화)', title: '뉴욕의 또 다른 얼굴, 퀸즈 & 브루클린', details: '<b>오전:</b> 퀸즈 플러싱에서 다양한 아시안 음식 맛보기 또는 아스토리아에서 그리스 문화 체험<br><b>점심:</b> 현지 맛집에서 식사<br><b>오후:</b> 브루클린 윌리엄스버그의 빈티지 샵과 트렌디한 카페 탐방<br><b>저녁:</b> 윌리엄스버그 브루어리에서 수제 맥주 즐기기' },
            { day: 14, date: '11/5 (수)', title: '마지막 쇼핑과 아쉬움 달래기', details: '<b>오전:</b> 우드버리 아울렛 또는 시내 백화점에서 마지막 쇼핑<br><b>점심:</b> 간단히 해결 후, 맨해튼으로 돌아와 못 가본 곳 방문하기<br><b>저녁:</b> 이스트 강 페리를 타며 맨해튼 야경을 배경으로 마지막 저녁 식사 및 여행 정리' },
            { day: 15, date: '11/6 (목)', title: '일상으로, 한국으로 출발', details: '<b>오전:</b> 공항 이동 전, 가벼운 아침 식사 및 짐 최종 정리<br><b>낮:</b> JFK 공항으로 이동<br><b>12:00:</b> 뉴욕 출발, 즐거웠던 추억을 안고 한국으로' }
        ]
    };
    let DATA = JSON.parse(localStorage.getItem(STORAGE_KEY)) || DEFAULT_DATA;
    const saveData = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA));

    const renderAll = () => { renderItinerary(); renderAccommodations(); renderRestaurants(); renderChecklist(); renderSettlement(); renderBudget(); renderTips(); startCountdown(); }
    const renderItinerary = () => { const c = document.getElementById('itinerary-accordion'); if (!c) return; c.innerHTML = DATA.itinerary.map(i => `<div class="border rounded-lg overflow-hidden bg-white"><div class="accordion-header flex justify-between items-center p-4 cursor-pointer"><div class="flex items-center gap-4"><span class="font-bold text-blue-600 w-8 text-center">Day ${i.day}</span><div><p class="font-bold text-lg">${i.title}</p><p class="text-sm text-gray-500">${i.date}</p></div></div><ion-icon name="chevron-down-outline" class="text-2xl transition-transform duration-300"></ion-icon></div><div class="accordion-content bg-gray-50/70"><div class="p-4 sm:p-5 border-t text-gray-700 leading-relaxed text-sm">${`<ul class="space-y-3">${i.details.split('<br>').map(l => `<li class="flex items-start"><strong class="w-16 shrink-0 text-right mr-2 text-gray-500 font-medium">${l.split(':</b>')[0].replace(/<b>/g, '')}:</strong><span class="flex-1">${l.split(':</b>')[1]}</span></li>`).join('')}</ul>`}</div></div></div>`).join(''); };
    const renderAccommodations = () => { const c = document.getElementById('accommodation-list'); if (!c) return; c.innerHTML = DATA.accommodations.map((item, index) => `<div class="bg-gray-50 p-4 rounded-lg border"><div class="flex flex-wrap justify-between items-start gap-2"><div><p class="font-bold" contenteditable="true" data-prop="name" data-index="${index}">${item.name}</p><input type="text" placeholder="주소 입력..." class="text-sm text-gray-600 w-full mt-1 p-2 border rounded-md" value="${item.address}" data-prop="address" data-index="${index}" style="min-width: 250px;"><p class="text-sm text-gray-600 mt-2">${item.dates} | 총 ${item.price.toLocaleString('ko-KR')}원</p><p class="text-sm text-blue-600 font-semibold">인당 ${(item.price / 2).toLocaleString('ko-KR')}원</p></div><button class="status-toggle ${item.booked ? 'paid' : 'pending'}" data-index="${index}">${item.booked ? '예약 완료' : '예약 예정'}</button></div><div class="mt-3"><input type="text" placeholder="체크인 시간, 특이사항 등 메모" class="w-full p-2 border rounded-md text-sm focus:ring-2 focus:ring-blue-500" value="${item.memo}" data-prop="memo" data-index="${index}"></div></div>`).join(''); };
    const renderRestaurants = () => {
        const container = document.getElementById('restaurant-accordion-container'); if (!container) return;
        let html = '';
        for (const category in DATA.restaurants) {
            html += `<div class="border rounded-lg overflow-hidden bg-white">
                <div class="accordion-header flex justify-between items-center p-4 cursor-pointer">
                    <h4 class="font-bold text-lg">${category}</h4>
                    <ion-icon name="chevron-down-outline" class="text-2xl transition-transform duration-300"></ion-icon>
                </div>
                <div class="accordion-content bg-gray-50/70">
                    <div class="p-2 sm:p-4 border-t">
                        <table class="w-full text-left text-sm">
                            <thead><tr class="border-b"><th class="p-2">맛집</th><th class="p-2">종류</th><th class="p-2 hidden md:table-cell">주소</th><th class="p-2 text-center">지도</th></tr></thead>
                            <tbody>${DATA.restaurants[category].map(r => `
                                <tr class="border-t">
                                    <td class="p-2 font-semibold">${r.name}</td>
                                    <td class="p-2">${r.food}</td>
                                    <td class="p-2 hidden md:table-cell">${r.address}</td>
                                    <td class="p-2 text-center"><a href="https://maps.google.com/?q=${encodeURIComponent(r.name + ", New York")}" target="_blank" class="text-blue-500"><ion-icon name="map-outline" class="text-xl"></ion-icon></a></td>
                                </tr>`).join('')}</tbody>
                        </table>
                    </div>
                </div>
            </div>`;
        }
        container.innerHTML = html;
    };
    const renderTips = () => { const c = document.getElementById('tips-list'); if (!c) return; c.innerHTML = DATA.tips.map(tip => `<div class="bg-gray-50 p-4 rounded-lg border"><h4 class="font-bold text-lg mb-2">${tip.title}</h4><p class="text-sm text-gray-700 leading-6">${tip.content}</p></div>`).join(''); }
    const renderChecklist = () => { const c = document.getElementById('checklist-container'); if (!c) return; c.innerHTML = DATA.checklist.map((section, sIdx) => `<div class="bg-gray-50 p-4 rounded-lg checklist-section relative"><div class="flex justify-between items-center mb-2"><h4 class="font-bold editable-title" contenteditable="true" data-section-index="${sIdx}">${section.title}</h4><button class="delete-section-btn text-gray-400 hover:text-red-500" data-section-index="${sIdx}"><ion-icon name="close-circle-outline"></ion-icon></button></div><ul class="space-y-2 text-sm">${section.items.map((item, iIdx) => `<li class="checklist-item flex items-center justify-between"><label class="flex items-center flex-grow"><input type="checkbox" class="mr-2" ${item.checked?'checked':''} data-section-index="${sIdx}" data-item-index="${iIdx}"><span class="checklist-item-text" contenteditable="true" data-section-index="${sIdx}" data-item-index="${iIdx}">${item.text}</span></label><button class="delete-btn text-gray-400 hover:text-red-500 text-xs" data-section-index="${sIdx}" data-item-index="${iIdx}"><ion-icon name="remove-circle-outline"></ion-icon></button></li>`).join('')}</ul><button class="add-item-btn mt-3 text-xs text-blue-500 font-semibold" data-section-index="${sIdx}">+ 항목 추가</button></div>`).join(''); };
    const renderBudget = () => { const c = document.querySelector('#budget-table tbody'); if (!c) return; c.innerHTML = DATA.budget.map((b, index) => { if (b.status === 'special') return `<tr class="border-b"><td class="p-3">${b.item}</td><td class="p-3 text-right">+ α</td><td class="p-3 text-center"><span class="text-sm text-gray-500">별도 계산</span></td></tr>`; return `<tr class="border-b"><td class="p-3" contenteditable="true" data-index="${index}" data-prop="item">${b.item}</td><td class="p-3 text-right cost-cell" contenteditable="true" data-index="${index}" data-prop="cost">${b.cost.toLocaleString('ko-KR')}</td><td class="p-3 text-center"><button class="status-toggle ${b.status}" data-index="${index}">${b.status === 'paid' ? '결제 완료' : '지출 예정'}</button></td></tr>`; }).join(''); updateTotal(); };
    const renderSettlement = () => {
        const listC = document.getElementById('settlement-list'), summaryC = document.getElementById('settlement-summary'), payerSelect = document.getElementById('settlement-payer');
        if (!listC || !summaryC || !payerSelect) return;
        
        payerSelect.innerHTML = `<option value="user1">${DATA.user1Name.substring(1)}가 냄</option><option value="user2">${DATA.user2Name.substring(1)}가 냄</option>`;
        
        listC.innerHTML = DATA.settlements.map((item, index) => `<tr class="settlement-item ${item.payer === 'user1' ? 'user1-payment-row' : 'user2-payment-row'}"><td class="p-2">${item.date}</td><td class="p-2">${item.desc}</td><td class="p-2 text-right">$${item.amount.toLocaleString('en-US')}</td><td class="p-2 text-center">${item.payer === 'user1' ? `${DATA.user1Name.substring(1)}가 냄` : `${DATA.user2Name.substring(1)}가 냄`}</td><td class="p-2 text-right"><button class="delete-btn text-gray-400 hover:text-red-500" data-index="${index}"><ion-icon name="trash-outline"></ion-icon></button></td></tr>`).join('');
        const total = DATA.settlements.reduce((s, i) => s + i.amount, 0), user1Spent = DATA.settlements.filter(i => i.payer === 'user1').reduce((s, i) => s + i.amount, 0), toSettle = (total / 2) - user1Spent, toSettleKrw = toSettle * USD_TO_KRW;
        summaryC.innerHTML = `<div class="bg-white p-3 rounded-lg shadow-sm"><p class="text-xs text-gray-500">총 공동경비</p><p class="font-bold">$${total.toLocaleString('en-US')}</p><p class="text-xs text-gray-500">~ ₩${(total * USD_TO_KRW).toLocaleString('ko-KR')}</p></div><div class="bg-white p-3 rounded-lg shadow-sm"><p class="text-xs text-gray-500">정산할 금액</p><p class="font-bold text-red-600">${toSettle === 0 ? '정산 완료' : toSettle > 0 ? `${DATA.user1Name.substring(1)}가 줘야함` : `${DATA.user2Name.substring(1)}가 줘야함`}</p><p class="text-sm font-semibold text-red-600">${toSettle === 0 ? '' : `$${Math.abs(toSettle).toLocaleString('en-US')} (₩${Math.abs(toSettleKrw).toLocaleString('ko-KR')})`}</p></div>`;
    };
    const updateTotal = () => { const totalEl = document.getElementById('total-cost'); if (!totalEl) return; const total = DATA.budget.filter(b=>b.status !== 'special').reduce((s, i) => s + i.cost, 0); totalEl.innerText = `₩${total.toLocaleString('ko-KR')} + α`; };
    const startCountdown = () => { const countDownDate = new Date("Oct 23, 2025 10:00:00").getTime(); const D = document.getElementById("days"); if(!D) return; const interval = setInterval(() => { const now = new Date().getTime(), distance = countDownDate - now; if (distance < 0) { clearInterval(interval); document.getElementById("countdown-container").innerHTML = `<div class="text-3xl font-bold">🎉 ENJOY YOUR TRIP! 🎉</div>`; return; } D.textContent = Math.floor(distance / 86400000); const H = document.getElementById("hours"), M = document.getElementById("minutes"), S = document.getElementById("seconds"); if (H) H.parentElement.style.display = 'none'; if (M) M.parentElement.style.display = 'none'; if(S) S.parentElement.style.display = 'none'; document.querySelector('#countdown-container').classList.replace('md:grid-cols-4', 'grid-cols-1'); document.querySelector('#countdown-container').classList.replace('gap-4', 'gap-0'); }, 1000); };
    
    document.addEventListener('DOMContentLoaded', () => {
        renderAll();
        document.body.addEventListener('click', e => {
            const target = e.target;
            const button = target.closest('button');
            if (target.closest('.accordion-header')) {
                const header = target.closest('.accordion-header');
                const content = header.nextElementSibling;
                const icon = header.querySelector('ion-icon');
                if (content.style.maxHeight) { content.style.maxHeight = null; icon.style.transform = 'rotate(0deg)'; } 
                else { content.style.maxHeight = content.scrollHeight + "px"; icon.style.transform = 'rotate(180deg)'; }
            } else if (button) {
                if (button.closest('.tab-button')) {
                    const tabName = button.dataset.tab;
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
                    document.getElementById(tabName)?.classList.remove('hidden');
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                } else if (button.matches('.status-toggle')) {
                    const index = button.dataset.index;
                    if(button.closest('#budget-table')) { DATA.budget[index].status = DATA.budget[index].status === 'pending' ? 'paid' : 'pending'; renderBudget(); } 
                    else { DATA.accommodations[index].booked = !DATA.accommodations[index].booked; renderAccommodations(); }
                    saveData();
                } else if (button.id === 'add-checklist-section-btn') {
                    const title = prompt("새로운 체크리스트 섹션 제목:", "새로운 목록");
                    if (title) { DATA.checklist.push({ title, items: [] }); renderChecklist(); saveData(); }
                } else if (button.matches('.add-item-btn')) {
                    DATA.checklist[button.dataset.sectionIndex].items.push({ text: "새 항목", checked: false });
                    renderChecklist(); saveData();
                } else if (button.matches('.delete-btn') || button.matches('.delete-section-btn')) {
                    const sIdx = button.dataset.sectionIndex, iIdx = button.dataset.itemIndex;
                    if (iIdx) { DATA.checklist[sIdx].items.splice(iIdx, 1); } 
                    else { if (confirm(`'${DATA.checklist[sIdx].title}' 섹션을 삭제하시겠습니까?`)) DATA.checklist.splice(sIdx, 1); }
                    renderChecklist(); saveData();
                } else if (button.closest('#settlement-list [data-index]')) {
                     const index = button.closest('[data-index]').dataset.index;
                     DATA.settlements.splice(index, 1);
                     renderSettlement(); saveData();
                }
            }
        });

        document.body.addEventListener('focusout', e => {
            const target = e.target;
            const index = target.dataset.index;
            if (target.matches('#accommodation-list [data-prop]')) {
                DATA.accommodations[index][target.dataset.prop] = target.value || target.innerText;
            } else if (target.matches('#budget-table [contenteditable]')) {
                const prop = target.dataset.prop, value = prop === 'cost' ? parseFloat(target.innerText.replace(/,/g, '')) || 0 : target.innerText;
                DATA.budget[index][prop] = value;
                renderBudget();
            } else if (target.matches('.editable-title')) {
                DATA.checklist[target.dataset.sectionIndex].title = target.innerText;
            } else if (target.matches('.checklist-item-text')) {
                DATA.checklist[target.dataset.sectionIndex].items[target.dataset.itemIndex].text = target.innerText;
            } else { return; }
            saveData();
        });

        document.body.addEventListener('change', e => {
            const target = e.target;
            if (target.matches('.checklist-item input[type="checkbox"]')) {
                DATA.checklist[target.dataset.sectionIndex].items[target.dataset.itemIndex].checked = target.checked;
                saveData();
            }
        });
        
        document.getElementById('settlement-form')?.addEventListener('submit', e => {
            e.preventDefault();
            const form = e.target;
            DATA.settlements.push({ date: form.querySelector('#settlement-date').value, desc: form.querySelector('#settlement-desc').value, amount: parseFloat(form.querySelector('#settlement-amount').value), payer: form.querySelector('#settlement-payer').value });
            renderSettlement(); saveData(); form.reset();
            form.querySelector('#settlement-date').valueAsDate = new Date();
        });
        
        const dateInput = document.getElementById('settlement-date');
        if(dateInput) dateInput.valueAsDate = new Date();
    });
    </script>
</body>
</html>
